const _0x1eadf1=_0x2c46;(function(_0x36cf42,_0x2087fc){const _0x1fcca6=_0x2c46,_0xf5ea4a=_0x36cf42();while(!![]){try{const _0x6ccc62=-parseInt(_0x1fcca6(0x13d))/0x1+parseInt(_0x1fcca6(0x10d))/0x2*(parseInt(_0x1fcca6(0x13c))/0x3)+-parseInt(_0x1fcca6(0x119))/0x4+-parseInt(_0x1fcca6(0x11c))/0x5+parseInt(_0x1fcca6(0x12a))/0x6*(-parseInt(_0x1fcca6(0x117))/0x7)+-parseInt(_0x1fcca6(0x137))/0x8*(parseInt(_0x1fcca6(0x135))/0x9)+parseInt(_0x1fcca6(0x116))/0xa;if(_0x6ccc62===_0x2087fc)break;else _0xf5ea4a['push'](_0xf5ea4a['shift']());}catch(_0x4bad60){_0xf5ea4a['push'](_0xf5ea4a['shift']());}}}(_0x2a89,0xa7828));function _0x2a89(){const _0xb3c017=['updateECOControlledNode','all','getECOControlledNode','eco','data','catch','18PzyHPS','updateECOControlledNodeLinkActions','PermissionSet','Error\x20Getting\x20ECO\x20Controlled\x20Node','../helpers','getCADExchangerRevision','Cannot\x20get\x20CAD\x20Document\x20Revision','Error\x20Updating\x20ECO\x20Controlled\x20Node','Cannot\x20Generate\x20Public\x20URL\x20for\x20CAD\x20Document','Error\x20Getting\x20ECO\x20Controlled\x20Items','info','10847844juPLcW','plmController.js','8ropUEM','getProjectAssignments','includes','Error\x20Getting\x20ECO\x20Nodes','_id','933VssqOZ','1325340fFvrqf','message','publicCADDocument','send','createCADDocuments','source','Cannot\x20Get\x20Project\x20Assignments','Cannot\x20Create\x20CAD\x20Documents','clone','obsolete','Cannot\x20get\x20CAD\x20Document\x20FlatList','_version','save','../modules/dataService','code','addNodeToECO','status','getECOControlledItems','supFork','map','reverse','getECOProcessedItems','params','body','new','_releasedUntil','getCadDocumentFlatList','1598kuwUNY','user','Relationship','fork','Cannot\x20Create\x20CAD\x20Document','_type','createCADDocument','generated','../helpers/errorsHelpers','48861330FBYCBL','536711pyYnds','getECOAllItems','5047348iyYqUn','then','../middlewares/businessMethods','2129950igrtPs','push','now','revision','Error\x20Getting\x20ECO\x20Processed\x20Items','properties','Error\x20on\x20ECO\x20changes','instanciateNode'];_0x2a89=function(){return _0xb3c017;};return _0x2a89();}const helpers=require('../helpers/controllerHelpers'),{buildNewVersion}=require(_0x1eadf1(0x12e)),plmStandards=require('../middlewares/plmStandardsCypher'),plmBusinnessMethods=require(_0x1eadf1(0x11b)),DataService=require(_0x1eadf1(0xff)),{cloneProperties}=require('../utils/nodetype'),{isError}=require(_0x1eadf1(0x115)),{logAndReturn,logAndRespond}=helpers;function _0x2c46(_0x2ba25e,_0x5d8687){const _0x2a89a2=_0x2a89();return _0x2c46=function(_0x2c463b,_0x362e13){_0x2c463b=_0x2c463b-0xff;let _0x8316e9=_0x2a89a2[_0x2c463b];return _0x8316e9;},_0x2c46(_0x2ba25e,_0x5d8687);}module['exports']={'addNodeToECO':async(_0xe82290,_0x51124b)=>{const _0x205de2=_0x1eadf1,{ecoId:_0x18a2b8,nodeId:_0x14c38e}=_0xe82290[_0x205de2(0x108)],{user:_0x1fbe12}=_0xe82290;await plmStandards[_0x205de2(0x101)](_0x18a2b8,_0x14c38e,_0x1fbe12)[_0x205de2(0x11a)](({data:_0x898a72,code:_0x1920db})=>{const _0x32f972=_0x205de2;return _0x51124b[_0x32f972(0x102)](_0x1920db)[_0x32f972(0x140)](_0x898a72);})[_0x205de2(0x129)](_0x3a813d=>{const _0x4bdf80=_0x205de2;return logAndReturn(_0x4bdf80(0x136),!![],_0x51124b,0x1f4,'addNodeToECO',__('Cannot\x20Add\x20Node\x20to\x20ECO'),_0x3a813d[_0x4bdf80(0x13e)],'',_0x3a813d);});},'getECOControlledNodes':async(_0x4871c7,_0x23a8b9)=>{const _0x173f3a=_0x1eadf1,{ecoId:_0x3fbe46}=_0x4871c7[_0x173f3a(0x108)];await plmStandards['getECOControlledNodes'](_0x3fbe46)['then'](({data:_0x524f0d,code:_0x527628})=>{const _0xda37eb=_0x173f3a;return _0x23a8b9[_0xda37eb(0x102)](_0x527628)[_0xda37eb(0x140)](_0x524f0d);})[_0x173f3a(0x129)](_0x6e09f7=>{const _0x58d611=_0x173f3a;return logAndReturn(_0x58d611(0x136),!![],_0x23a8b9,0x1f4,'getECOControlledNodes',__('Error\x20Getting\x20ECO\x20Controlled\x20Nodes'),_0x6e09f7[_0x58d611(0x13e)],'',_0x6e09f7);});},'getECOAllItems':async(_0x59d564,_0x2c822b)=>{const _0x3519e8=_0x1eadf1,{ecoId:_0x579f74}=_0x59d564[_0x3519e8(0x108)];await plmStandards[_0x3519e8(0x118)](_0x579f74)[_0x3519e8(0x11a)](({data:_0x5b45bb,code:_0x3228a4})=>{const _0xe1c965=_0x3519e8;return _0x2c822b[_0xe1c965(0x102)](_0x3228a4)[_0xe1c965(0x140)](_0x5b45bb);})[_0x3519e8(0x129)](_0x3d93fe=>{const _0x1966aa=_0x3519e8;return logAndReturn(_0x1966aa(0x136),!![],_0x2c822b,0x1f4,'getECOAllItems',__(_0x1966aa(0x13a)),_0x3d93fe[_0x1966aa(0x13e)],'',_0x3d93fe);});},'getECOControlledNode':async(_0x15256a,_0xdeb1f5)=>{const _0x12b028=_0x1eadf1,{ecoId:_0x80ab5f,nodeId:_0x265527}=_0x15256a[_0x12b028(0x108)];await plmStandards[_0x12b028(0x126)](_0x80ab5f,_0x265527)[_0x12b028(0x11a)](({data:_0xe3fdf,code:_0xdc22c6})=>{const _0x5bcaee=_0x12b028;return _0xdeb1f5[_0x5bcaee(0x102)](_0xdc22c6)[_0x5bcaee(0x140)](_0xe3fdf);})[_0x12b028(0x129)](_0x4ed829=>{const _0x3d53c1=_0x12b028;return logAndReturn(_0x3d53c1(0x136),!![],_0xdeb1f5,0x1f4,'getECOControlledNode',__(_0x3d53c1(0x12d)),_0x4ed829['message'],'',_0x4ed829);});},'updateECOControlledNode':async(_0x12a793,_0x2bb36d)=>{const _0x5ecca1=_0x1eadf1,{ecoId:_0x4129c3,nodeId:_0x4b64fa}=_0x12a793[_0x5ecca1(0x108)],_0x2bd237=_0x12a793[_0x5ecca1(0x109)];await plmStandards[_0x5ecca1(0x124)](_0x4129c3,_0x4b64fa,_0x2bd237)['then'](({data:_0x333699,code:_0xbbd4c4})=>{const _0x36871=_0x5ecca1;return _0x2bb36d['status'](_0xbbd4c4)[_0x36871(0x140)](_0x333699);})[_0x5ecca1(0x129)](_0x31f454=>{const _0x5b249a=_0x5ecca1;return logAndReturn('plmController.js',!![],_0x2bb36d,0x1f4,'updateECOControlledNode',__(_0x5b249a(0x131)),_0x31f454[_0x5b249a(0x13e)],'',_0x31f454);});},'updateECOControlledNodeLinkActions':async(_0x197f6b,_0x1db333)=>{const _0x5d0b28=_0x1eadf1,{ecoId:_0x8043af,nodeId:_0x5b1ec8}=_0x197f6b[_0x5d0b28(0x108)],_0x3afd88=_0x197f6b[_0x5d0b28(0x109)];await plmStandards[_0x5d0b28(0x12b)](_0x8043af,_0x5b1ec8,_0x3afd88)['then'](({data:_0x19fd52,code:_0x4f413b})=>{const _0x486555=_0x5d0b28;return _0x1db333[_0x486555(0x102)](_0x4f413b)['send'](_0x19fd52);})[_0x5d0b28(0x129)](_0x3424a0=>{const _0x134d54=_0x5d0b28;return logAndReturn(_0x134d54(0x136),!![],_0x1db333,0x1f4,_0x134d54(0x12b),__('Error\x20Updating\x20ECO\x20Controlled\x20Node\x20Link\x20Actions'),_0x3424a0[_0x134d54(0x13e)],'',_0x3424a0);});},'removeNodeFromECO':async(_0x533f63,_0x4f625d)=>{const _0x399c94=_0x1eadf1,{ecoId:_0x1a8d74,nodeId:_0x11a203}=_0x533f63[_0x399c94(0x108)];await plmStandards['removeNodeFromECO'](_0x1a8d74,_0x11a203)['then'](({data:_0x180033,code:_0x45623d})=>{const _0x554435=_0x399c94;return _0x4f625d[_0x554435(0x102)](_0x45623d)[_0x554435(0x140)](_0x180033);})[_0x399c94(0x129)](_0x3f141b=>{const _0xe92948=_0x399c94;return logAndReturn(_0xe92948(0x136),!![],_0x4f625d,0x1f4,'removeNodeFromECO',__('Error\x20Removing\x20Node\x20from\x20ECO'),_0x3f141b['message'],'',_0x3f141b);});},'getECOControlledItems':async(_0x3043f9,_0x4f4acd)=>{const _0x17efff=_0x1eadf1,{ecoId:_0x2346b0}=_0x3043f9[_0x17efff(0x108)];await plmStandards[_0x17efff(0x103)](_0x2346b0)[_0x17efff(0x11a)](({data:_0x3ca3d8,code:_0x2eb68c})=>{const _0x4b02ff=_0x17efff;return _0x4f4acd[_0x4b02ff(0x102)](_0x2eb68c)[_0x4b02ff(0x140)](_0x3ca3d8);})[_0x17efff(0x129)](_0x3e6246=>{const _0x3b06bc=_0x17efff;return logAndReturn(_0x3b06bc(0x136),!![],_0x4f4acd,0x1f4,_0x3b06bc(0x103),__(_0x3b06bc(0x133)),_0x3e6246['message'],'',_0x3e6246);});},'getECOProcessedItems':async(_0x4ddb62,_0x1ceadc)=>{const _0x6a293f=_0x1eadf1,{ecoId:_0x4b74fa}=_0x4ddb62[_0x6a293f(0x108)];await plmStandards[_0x6a293f(0x107)](_0x4b74fa)['then'](({data:_0x360a49,code:_0x49aab5})=>{const _0x17261d=_0x6a293f;return _0x1ceadc[_0x17261d(0x102)](_0x49aab5)[_0x17261d(0x140)](_0x360a49);})[_0x6a293f(0x129)](_0x260b40=>{const _0x2aa0d1=_0x6a293f;return logAndReturn(_0x2aa0d1(0x136),!![],_0x1ceadc,0x1f4,'getECOProcessedItems',__(_0x2aa0d1(0x120)),_0x260b40['message'],'',_0x260b40);});},'processECONode':async(_0x486c6a,_0x13f132)=>{const _0x4e1d96=_0x1eadf1,{user:_0x199b66,node:_0x2cf31e,ecoRelationship:_0xabb712}=_0x486c6a,{action:_0x5085ca,newRef:_0xb7885a}=_0x486c6a['body'],_0x10d0b3=[_0x2cf31e];try{if(_0x5085ca===_0x4e1d96(0x146))return _0x2cf31e[_0x4e1d96(0x121)]['_state']=!![],_0x2cf31e[_0x4e1d96(0x121)][_0x4e1d96(0x10b)]=Date[_0x4e1d96(0x11e)](),await DataService[_0x4e1d96(0x149)](_0x2cf31e),_0x13f132[_0x4e1d96(0x102)](0xc8)[_0x4e1d96(0x140)](_0x2cf31e);const {_version:_0x12ad80,_state:_0x5170ca}=_0x2cf31e[_0x4e1d96(0x121)],_0x3a9be3=buildNewVersion(_0x12ad80,_0x5085ca),_0x4ca53f=cloneProperties(_0x2cf31e);_0x4ca53f['properties'][_0x4e1d96(0x148)]=_0x3a9be3,_0x4ca53f[_0x4e1d96(0x10e)]=_0x199b66;const _0x5d1442=await DataService['new'](_0x4ca53f);_0x5d1442[_0x4e1d96(0x145)]=!![],await DataService[_0x4e1d96(0x149)](_0x5d1442),_0x10d0b3[_0x4e1d96(0x11d)](_0x5d1442);const {data:_0x53214e}=await DataService[_0x4e1d96(0x125)](_0x4e1d96(0x10f),{'node':_0x2cf31e,'user':_0x199b66}),_0x2df640=_0x53214e,_0x267c95=_0x2df640[_0x4e1d96(0x105)](async _0x5f227b=>{const _0x2f780f=_0x4e1d96,{_type:_0x5dfd69,source:_0x161e49,target:_0x4797b2}=_0x5f227b,_0x4ae3b5=_0x5dfd69===_0x2f780f(0x11f)||_0x5dfd69===_0x2f780f(0x110),_0x2fa8a3=_0x161e49[_0x2f780f(0x112)]===_0x2f780f(0x127),_0x9c7523=_0x161e49[_0x2f780f(0x112)]===_0x2f780f(0x12c),_0x508106=_0x4ae3b5||_0x2fa8a3||_0x9c7523;if(_0x508106)return;const _0x23dd74=cloneProperties(_0x5f227b);_0x23dd74[_0x2f780f(0x142)]=_0x161e49['_id']===_0x2cf31e[_0x2f780f(0x13b)]?_0x5d1442:_0x161e49,_0x23dd74['target']=_0x4797b2[_0x2f780f(0x13b)]===_0x2cf31e[_0x2f780f(0x13b)]?_0x5d1442:_0x4797b2,_0x23dd74[_0x2f780f(0x10e)]=_0x199b66;const _0x68b546=await DataService[_0x2f780f(0x10a)](_0x23dd74);return await DataService[_0x2f780f(0x149)](_0x68b546),_0x10d0b3[_0x2f780f(0x11d)](_0x68b546),_0x68b546;});await Promise[_0x4e1d96(0x125)](_0x267c95);const _0x30e1eb=_0x2cf31e['datamodel']['versioningRule']||{},_0x111cf7=_0x30e1eb[_0x5085ca]||_0x5085ca,_0x474798=Object['keys'](_0x30e1eb)[_0x4e1d96(0x139)](_0x5085ca)?_0x4e1d96(0x11f):undefined,_0x19e50d=[_0x4e1d96(0x110),_0x4e1d96(0x104)][_0x4e1d96(0x139)](_0x5085ca)?_0x4e1d96(0x110):undefined,_0x3b1da8=_0x474798||_0x19e50d,_0x4bce8b=_0x5085ca===_0x4e1d96(0x110)?!![]:null,_0x1773fc={'_superseeded':_0x4bce8b,'_revType':_0x111cf7},_0x5504cb={'_type':_0x3b1da8,'source':_0x5d1442,'target':_0x2cf31e,'properties':_0x1773fc,'user':_0x199b66},_0xc15fb7=await DataService['new'](_0x5504cb);await DataService['save'](_0xc15fb7),_0x10d0b3['push'](_0xc15fb7);_0x474798&&(_0x2cf31e[_0x4e1d96(0x121)]['_lockable']=![],await DataService[_0x4e1d96(0x149)](_0x2cf31e));if(_0xabb712){const {source:_0x56f190,properties:_0x468074}=_0xabb712,{_changeComment:_0x44f594}=_0x468074,_0x48032f={'_type':_0x4e1d96(0x114),'source':_0x56f190,'target':_0x5d1442,'properties':{'action':_0x5085ca,'_changeComment':_0x44f594,'_sourceNode':_0x2cf31e[_0x4e1d96(0x13b)]},'user':_0x199b66},_0x1ce823=await DataService['new'](_0x48032f);await DataService[_0x4e1d96(0x149)](_0x1ce823),_0x10d0b3['push'](_0x1ce823);const _0x247a08={'_handled':!![],'type':linkName,'_handledState':_0x5170ca};Object['assign'](_0x468074,_0x247a08),await DataService[_0x4e1d96(0x149)](_0xabb712);}return _0x13f132[_0x4e1d96(0x102)](0xc8)[_0x4e1d96(0x140)](_0x5d1442);}catch(_0x4e7636){const _0x67e0cb=_0x10d0b3[_0x4e1d96(0x106)]()['map'](async _0x3bc0cc=>{const _0x4de686=_0x4e1d96,{_type:_0x3ae2a9,_id:_0x5479a4}=_0x3bc0cc;if(_0x5479a4===_0x2cf31e['_id'])return _0x2cf31e[_0x4de686(0x121)]=_0x3bc0cc[_0x4de686(0x121)],await DataService['save'](_0x2cf31e),_0x3ae2a9+':\x20Changes\x20rollbacked.';const {data:_0xc60c1c}=await DataService['delete'](_0x3bc0cc);return _0x3ae2a9+':\x20'+_0xc60c1c[_0x4de686(0x13e)];}),_0x86657e=await Promise[_0x4e1d96(0x125)](_0x67e0cb);return console[_0x4e1d96(0x134)](_0x86657e),logAndRespond(_0x13f132,_0x4e7636,__(_0x4e1d96(0x122)));}},'instanciateNode':async(_0x3d183a,_0x1676ae,_0xb6200d)=>{const _0x366e83=_0x1eadf1,{user:_0x15608b}=_0x3d183a,{nodetype:_0x33191e,nodeId:_0x5277ba}=_0x3d183a[_0x366e83(0x108)],{instanciationId:_0x63e11e}=_0x3d183a[_0x366e83(0x109)];await plmStandards[_0x366e83(0x123)](_0x15608b,_0x33191e,_0x5277ba,_0x63e11e)[_0x366e83(0x11a)](({data:_0x457254,code:_0x45b8a8})=>{const _0x3a152f=_0x366e83;_0x3d183a[_0x3a152f(0x128)]=_0x457254,_0x3d183a[_0x3a152f(0x100)]=_0x45b8a8,_0xb6200d();})[_0x366e83(0x129)](_0x521299=>{const _0x39b589=_0x366e83;return logAndReturn(_0x39b589(0x136),!![],_0x1676ae,0x1f4,_0x39b589(0x123),__('Cannot\x20Instanciate\x20Node'),_0x521299['message'],'',_0x521299);});},'getProjectAssignments':async(_0x5aa30e,_0x2d06fb)=>{const _0x4d29dd=_0x1eadf1,{projectId:_0x50dfbd}=_0x5aa30e[_0x4d29dd(0x108)];try{const {data:_0xbb89bf,code:_0x26b78c}=await plmBusinnessMethods['getProjectAssignments'](_0x50dfbd);_0x2d06fb[_0x4d29dd(0x102)](_0x26b78c)[_0x4d29dd(0x140)](_0xbb89bf);}catch(_0x1a1787){return logAndReturn(_0x4d29dd(0x136),!![],_0x2d06fb,0x1f4,_0x4d29dd(0x138),__(_0x4d29dd(0x143)),_0x1a1787[_0x4d29dd(0x13e)],'',_0x1a1787);}},'createCADDocument':async(_0x2c837d,_0xd291)=>{const _0x4a892a=_0x1eadf1,{user:_0x10effd}=_0x2c837d,{file:_0x219388,thumbnail:_0x52ddac,properties:_0x48fbf3,createPart:createPart=!![]}=_0x2c837d[_0x4a892a(0x109)];plmStandards[_0x4a892a(0x113)](_0x10effd,_0x219388,_0x52ddac,_0x48fbf3,createPart)[_0x4a892a(0x11a)](({data:_0x179af1,code:_0x504047})=>{const _0x2303f0=_0x4a892a;return _0xd291[_0x2303f0(0x102)](_0x504047)[_0x2303f0(0x140)](_0x179af1);})['catch'](_0x103f96=>{const _0x3e410d=_0x4a892a;return logAndReturn('plmController.js',!![],_0xd291,0x1f4,_0x3e410d(0x113),__(_0x3e410d(0x111)),_0x103f96[_0x3e410d(0x13e)],'',_0x103f96);});},'publicCADDocument':async(_0x5db8da,_0x21309d)=>{const _0x520b8e=_0x1eadf1,{user:_0xd24810}=_0x5db8da,{nodeId:_0x323fed}=_0x5db8da[_0x520b8e(0x108)];plmStandards[_0x520b8e(0x13f)](_0xd24810,_0x323fed)[_0x520b8e(0x11a)](({data:_0x22bb9e,code:_0x478cce})=>{const _0x5811f5=_0x520b8e;return _0x21309d[_0x5811f5(0x102)](_0x478cce)['send'](_0x22bb9e);})[_0x520b8e(0x129)](_0x121195=>{const _0x5ce05a=_0x520b8e;return logAndReturn('plmController.js',!![],_0x21309d,0x1f4,'publicCADDocument',__(_0x5ce05a(0x132)),_0x121195[_0x5ce05a(0x13e)],'',_0x121195);});},'getCADExchangerRevision':async(_0x4545f9,_0x52200b)=>{const _0x1c4c39=_0x1eadf1,{user:_0x3534f0}=_0x4545f9,{id:_0x17aafa}=_0x4545f9['params'];plmStandards[_0x1c4c39(0x12f)](_0x3534f0,_0x17aafa)[_0x1c4c39(0x11a)](({data:_0x438600,code:_0x48f1ec})=>{const _0x204a81=_0x1c4c39;return _0x52200b[_0x204a81(0x102)](_0x48f1ec)[_0x204a81(0x140)](_0x438600);})[_0x1c4c39(0x129)](_0x59568e=>{const _0x47d08c=_0x1c4c39;return logAndReturn(_0x47d08c(0x136),!![],_0x52200b,0x1f4,_0x47d08c(0x12f),__(_0x47d08c(0x130)),_0x59568e[_0x47d08c(0x13e)],'',_0x59568e);});},'getCadDocumentFlatList':async(_0x2ab009,_0x583513)=>{const _0x4c6659=_0x1eadf1,{user:_0x56ba87}=_0x2ab009,{id:_0x5d1a3b}=_0x2ab009[_0x4c6659(0x108)];plmStandards[_0x4c6659(0x10c)](_0x56ba87,_0x5d1a3b)['then'](({data:_0x58b04c,code:_0x56f44d})=>{const _0xee6671=_0x4c6659;return _0x583513[_0xee6671(0x102)](_0x56f44d)[_0xee6671(0x140)](_0x58b04c);})[_0x4c6659(0x129)](_0x2ec06c=>{const _0x3cfb4c=_0x4c6659;return logAndReturn(_0x3cfb4c(0x136),!![],_0x583513,0x1f4,_0x3cfb4c(0x10c),__(_0x3cfb4c(0x147)),_0x2ec06c[_0x3cfb4c(0x13e)],'',_0x2ec06c);});},'createCADDocuments':async(_0x4a86e4,_0x1d38aa)=>{const _0x5a542d=_0x1eadf1;_0x4a86e4['setTimeout'](0x7a120);const {user:_0x516d1e}=_0x4a86e4;plmStandards[_0x5a542d(0x141)](_0x516d1e,_0x4a86e4[_0x5a542d(0x109)])[_0x5a542d(0x11a)](({data:_0x1ac85f,code:_0x3b05c4})=>{const _0x59720e=_0x5a542d;return _0x1d38aa['status'](_0x3b05c4)[_0x59720e(0x140)](_0x1ac85f);})[_0x5a542d(0x129)](_0x333625=>{const _0x3b81cd=_0x5a542d;return logAndReturn(_0x3b81cd(0x136),!![],_0x1d38aa,0x1f4,_0x3b81cd(0x141),__(_0x3b81cd(0x144)),_0x333625[_0x3b81cd(0x13e)],'',_0x333625);});}};